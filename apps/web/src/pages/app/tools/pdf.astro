---
export const prerender = false;

import DashboardLayout from "@/layouts/DashboardLayout.astro";
import ToolPageLayout from "@/components/ToolPageLayout.astro";
import { requireAuth } from "@/lib/auth-check";

let session;
try {
  session = await requireAuth(Astro.request);
} catch (response) {
  return response as Response;
}
---

<DashboardLayout title="PDF Tools">
  <ToolPageLayout
    title="PDF Tools"
    description="Merge, split, compress, convert PDFs. Extract text and images."
    icon="file"
    tags={["Merge", "Split", "Compress", "Convert"]}
    status="pro"
  >
    <div class="space-y-6">
      <label class="block">
        <span class="text-sm font-medium mb-2 block">Operation</span>
        <select
          id="operation"
          class="w-full px-4 py-3 rounded-lg border border-border bg-background focus:outline-none focus:ring-2 focus:ring-accent"
        >
          <option value="merge">Merge PDFs</option>
          <option value="split">Split PDF</option>
          <option value="compress">Compress PDF</option>
          <option value="convert">Convert to PDF</option>
          <option value="extract">Extract Pages</option>
        </select>
      </label>

      <!-- Upload Area -->
      <div
        id="dropzone"
        class="border-2 border-dashed border-border rounded-lg p-12 text-center hover:border-accent transition-colors cursor-pointer"
      >
        <svg class="w-12 h-12 mx-auto mb-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/>
        </svg>
        <p class="text-sm font-medium mb-1">Drop PDF files here or click to browse</p>
        <p class="text-xs text-muted-foreground">PDF files up to 50MB each</p>
        <input type="file" id="fileInput" multiple accept=".pdf" class="hidden" />
      </div>

      <!-- Files List -->
      <div id="filesList" class="hidden space-y-2">
        <h3 class="text-sm font-medium">Selected Files</h3>
        <div id="filesContainer" class="space-y-2"></div>
      </div>

      <!-- Options -->
      <div id="options" class="hidden space-y-4">
        <div id="splitOptions" class="hidden">
          <label class="block">
            <span class="text-sm font-medium mb-2 block">Split Method</span>
            <select
              id="splitMethod"
              class="w-full px-4 py-3 rounded-lg border border-border bg-background focus:outline-none focus:ring-2 focus:ring-accent"
            >
              <option value="pages">By Page Numbers</option>
              <option value="range">By Page Range</option>
              <option value="size">By File Size</option>
            </select>
          </label>
        </div>

        <div id="compressOptions" class="hidden">
          <label class="block">
            <span class="text-sm font-medium mb-2 block">Compression Level</span>
            <select
              id="compressionLevel"
              class="w-full px-4 py-3 rounded-lg border border-border bg-background focus:outline-none focus:ring-2 focus:ring-accent"
            >
              <option value="low">Low (Best Quality)</option>
              <option value="medium" selected>Medium (Balanced)</option>
              <option value="high">High (Smallest Size)</option>
            </select>
          </label>
        </div>
      </div>

      <button
        id="processBtn"
        disabled
        class="w-full px-6 py-3 bg-primary text-primary-foreground rounded-lg font-medium hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
      >
        Process PDF
      </button>
    </div>
  </ToolPageLayout>
</DashboardLayout>

<script>
  const operation = document.getElementById("operation");
  const splitOptions = document.getElementById("splitOptions");
  const compressOptions = document.getElementById("compressOptions");

  operation?.addEventListener("change", (e) => {
    const op = (e.target).value;
    splitOptions?.classList.toggle("hidden", op !== "split");
    compressOptions?.classList.toggle("hidden", op !== "compress");
  });
</script>
